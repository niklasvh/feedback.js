(function(k,E,n){if(k.Feedback!==n){return}var p=function(G){k.console.log(G)},F=function(H){for(var I=0,G=H.length;I<G;I++){var J=Array.prototype.pop.call(H);if(J!==n){if(J.parentNode!==null){J.parentNode.removeChild(J)}}}},j=function(G){return G.getBoundingClientRect()},B=function(G){var H;while(((H=G.firstChild)!==null?G.removeChild(H):false)){}},d=function(G,I){var H=E.createElement(G);H.appendChild(E.createTextNode(I));return H},m=function(G,H){if(G.onload===n){if(G.onreadystatechange!==n){var I=function(){if(G.readyState!=="loaded"&&G.readyState!=="complete"){k.setTimeout(I,250)}else{H()}};k.setTimeout(I,250)}else{p("ERROR: We can't track when script is loaded")}}else{return H}},l,i,c=false,f=false,D,r,b,y,e,a,v,u,g="canvas",z="div",A="data-html2canvas-ignore",q="px",C,t,x,s,w,o="data-exclude",h;k.Feedback={debug:true,log:p,init:function(H){var I,K,G=E.body,L=E.createElement(z),J={open:function(){var P=E.createElement(z),O=E.createElement(z),Q,R=function(){try{H.onrendered=H.onrendered||function(T){i=T;c=true;M()};r=k.html2canvas([E.body],H)}catch(S){c=true;M();p("Error in html2canvas: "+S.message)}},N=d("a",H.closeLabel||"×");x=E.createElement(z);G.appendChild(L);s=E.createElement("textarea");if(k.html2canvas===n&&Q===n){Q=E.createElement("script");Q.src=H.h2cPath||"libs/html2canvas.js";Q.onerror=function(){h=false;p("Failed to load html2canvas library, check that the path is correctly defined")};Q.onload=(m)(Q,function(){if(k.html2canvas===n){p("Loaded html2canvas, but library not found");h=false;return}k.html2canvas.logging=k.Feedback.debug;R();h=true});I.parentNode.appendChild(Q)}else{R()}N.className=H.closeClass||"close";N.onclick=J.close;N.href="#";I.disabled=true;P.appendChild(N);P.appendChild(d("h3",H.modalHeader||"Send Feedback"));P.className="feedback-header";x.className="feedback-body";x.appendChild(d("p",H.modalIntro||"Please describe the issue you are experiencing"));x.appendChild(s);v=d("button",H.nextLabel||"Continue");v.className=H.buttonClass||"btn";v.onclick=function(){f=true;v.disabled=true;B(x);M()};function M(){var Z,X=true;if(f){v.onclick=function(af){af.preventDefault();G.removeEventListener("mousemove",t,false);G.removeEventListener("click",w,false);J.review()}}if(c&&f){v.disabled=false;var S,aa,ae,U=function(af){af.preventDefault();ac.classList.toggle("active");ad.classList.toggle("active");X=!X},V=function(){y.style.left="-5px";y.style.top="-5px";y.style.width="0px";y.style.height="0px";y.setAttribute(o,true);e.style.left="-5px";e.style.top="-5px";e.style.width="0px";e.style.height="0px";e.setAttribute(o,true);k.clearTimeout(S)},T=function(){a.style.left="-50px";a.style.top="-50px"},ac=d("a","Blackout"),ad=d("a","Highlight"),W;t=function(ah){if(ah.target!==W&&(ah.target.classList.contains("feedback-blackedout")||ah.target.classList.contains("feedback-highlighted"))){var ag=(parseInt(ah.target.style.left,10)+parseInt(ah.target.style.width,10));ag=Math.max(ag,10);ag=Math.min(ag,k.innerWidth-15);var af=(parseInt(ah.target.style.top,10));af=Math.max(af,10);a.style.left=ag+q;a.style.top=af+q;aa=ah.target;V();W=n;return}if(ah.target.nodeName==="BODY"||ah.target===a||ah.target===K||ah.target===v||ah.target.parentNode===K||ah.target.parentNode===P){V();W=ah.target;return}T();if(ah.target!==W){W=ah.target;k.clearTimeout(S);S=k.setTimeout(function(){var aj=j(W),ai;if(X===false){ai=y}else{ai=e;ai.width=aj.width;ai.height=aj.height;ae.drawImage(i,k.pageXOffset+aj.left,k.pageYOffset+aj.top,aj.width,aj.height,0,0,aj.width,aj.height)}ai.setAttribute(o,false);ai.style.left=k.pageXOffset+aj.left+q;ai.style.top=k.pageYOffset+aj.top+q;ai.style.width=aj.width+q;ai.style.height=aj.height+q},100)}};w=function(af){if(I.disabled===false){return}af.preventDefault();if(X===false){if(y.getAttribute(o)==="false"){var ag=E.createElement(z);ag.classList.add("feedback-blackedout");ag.style.left=y.style.left;ag.style.top=y.style.top;ag.style.width=y.style.width;ag.style.height=y.style.height;G.appendChild(ag);W=n}}else{if(e.getAttribute(o)==="false"){e.classList.add("feedback-highlighted");e.classList.remove("feedback-highlight-element");e=E.createElement("canvas");ae=e.getContext("2d");e.classList.add("feedback-highlight-element");G.appendChild(e);V();W=n}}};K.classList.add("feedback-animate-toside");y=E.createElement("div");e=E.createElement(g);ae=e.getContext("2d");a=d(z,"×");C=E.createElement("div");a.id="feedback-highlight-close";a.addEventListener("click",function(){aa.parentNode.removeChild(aa);T()},false);G.appendChild(a);i.classList.add("feedback-canvas");G.appendChild(i);var ab=[ad,ac];x.appendChild(d("p","Highlight or blackout important information"));for(var Y=0;Y<2;Y++){ab[Y].classList.add("btn");ab[Y].classList.add("btn-small");ab[Y].classList.add(Y===0?"active":"btn-inverse");ab[Y].href="#";ab[Y].onclick=U;x.appendChild(ab[Y]);x.appendChild(E.createTextNode(" "))}C.id="feedback-highlight-container";C.style.width=i.width+q;C.style.height=i.height+q;e.classList.add("feedback-highlight-element");y.id="feedback-blackout-element";G.appendChild(e);C.appendChild(y);G.appendChild(C);G.addEventListener("mousemove",t,false);G.addEventListener("click",w,false)}else{if(f){}}}O.className="feedback-footer";O.appendChild(v);K=E.createElement(z);K.className=H.modalClass||"modal";K.setAttribute(A,true);K.appendChild(P);K.appendChild(x);K.appendChild(O);I.parentNode.appendChild(K)},review:function(){K.classList.add("feedback-animate-review");B(x);var P=E.createElement(z);if(i!==n){var N=i.getContext("2d"),R,Q,M=5;N.fillStyle="#000";Array.prototype.slice.call(E.getElementsByClassName("feedback-blackedout"),0).forEach(function(T){var S=j(T);N.fillRect(S.left,S.top,S.width,S.height);G.removeChild(T)});var O=Array.prototype.slice.call(E.getElementsByClassName("feedback-highlighted"),0);if(O.length>0){R=E.createElement(g);Q=R.getContext("2d");R.width=i.width;R.height=i.height;Q.drawImage(i,0,0);N.fillStyle="#777";N.globalAlpha=0.5;N.fillRect(0,0,i.width,i.height);N.beginPath();O.forEach(function(W){var V=j(W);var T=parseInt(W.style.left,10),X=parseInt(W.style.top,10),U=parseInt(W.style.width,10),S=parseInt(W.style.height,10);N.moveTo(T+M,X);N.lineTo(T+U-M,X);N.quadraticCurveTo(T+U,X,T+U,X+M);N.lineTo(T+U,X+S-M);N.quadraticCurveTo(T+U,X+S,T+U-M,X+S);N.lineTo(T+M,X+S);N.quadraticCurveTo(T,X+S,T,X+S-M);N.lineTo(T,X+M);N.quadraticCurveTo(T,X,T+M,X);G.removeChild(W)});N.closePath();N.clip();N.globalAlpha=1;N.drawImage(R,0,0);F([L])}R=E.createElement(g);Q=R.getContext("2d");R.width=300;R.height=Math.round(i.height*(R.width/i.width));Q.drawImage(i,0,0,i.width,i.height,0,0,R.width,R.height);x.appendChild(R);v.firstChild.nodeValue="Send form";v.onclick=function(){var T=new XMLHttpRequest();var S=URL;var U="message="+s.value+"&image="+R.toDataURL("image/png");T.open("POST",S,true);T.setRequestHeader("Content-type","application/x-www-form-urlencoded");T.send(U);J.close()};i.classList.add("feedback-canvas-complete");P.style.height=R.height+20+q}P.classList.add("feedback-browser");P.appendChild(d("h3","Browser information"));x.appendChild(P);x.appendChild(d("p",H.modalIntro||"Please describe the issue you are experiencing"));x.appendChild(s)},close:function(){I.disabled=false;c=false;f=false;F([K,L,y,e,a,C,i]);F(E.getElementsByClassName("feedback-blackedout"));F(E.getElementsByClassName("feedback-highlighted"));G.removeEventListener("mousemove",t,false);G.removeEventListener("click",w,false);i=n;return false}};L.classList.add("feedback-glass");L.style.pointerEvents="none";L.setAttribute(A,true);H=H||{};I=d("button",H.label||"Send Feedback");I.className=H.labelClass||"btn bottom-right";I.setAttribute(A,true);I.onclick=J.open;((H.appendTo!==n)?H.appendTo:E.body).appendChild(I)}}})(window,document);